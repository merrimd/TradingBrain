       public async void RunProTrendCodeV2(ModelCandles candles) //,clsMinuteCandle currentFullCandle)
       {
           try
           {

               //////////////////////////
               // set up the log entry //
               //////////////////////////
               ModelLog log = new ModelLog();

               /////////////////////////////////////////////////////////
               // using the candle time determine which inputs to use //
               /////////////////////////////////////////////////////////
               //modelInstanceInputs thisInput = clsCommonFunctions.GetInputs(thisModel.inputs, candles.currentCandle.candleStart);
               modelInstanceInputs thisInput = clsCommonFunctions.GetInputsFromSpread(thisModel.inputs, candles.currentCandle.candleData);

               /////////////////////////////////////
               // Set the vars to be zero indexed //
               /////////////////////////////////////

               int newVar1 = thisInput.var1 - 1;
               int newVar2 = thisInput.var2 - 1;
               int newVar3 = thisInput.var3 - 1;
               int newVar13 = thisInput.var13 - 1;

               if (thisInput.var5 == 0) { thisInput.var5 = thisInput.var4; }
               if (thisInput.targetVarInputShort == 0) { thisInput.targetVarInputShort = thisInput.targetVarInput; }

               // Set target gain for trades
               targetVar = thisInput.targetVarInput / 100 + 1;
               targetVarShort = thisInput.targetVarInputShort / 100 + 1;

               // set nightingale target vars for setting nightingale qunatities
               nightingaleTargetVar = targetVar;
               nightingaleTargetVarShort = targetVarShort;

               if ((thisInput.spread == 1 || thisInput.spread == 2))
               {
                   modelInstanceInputs sp1Inputs = new modelInstanceInputs();
                   modelInstanceInputs sp2Inputs = new modelInstanceInputs();
                   sp1Inputs = thisModel.inputs.Where(i => i.spread == 1).FirstOrDefault();
                   sp2Inputs = thisModel.inputs.Where(i => i.spread == 2).FirstOrDefault();

                   if (sp1Inputs != null && sp2Inputs != null)
                   {
                       nightingaleTargetVar = Math.Min(sp1Inputs.targetVarInput / 100 + 1, sp2Inputs.targetVarInput / 100 + 1);
                       nightingaleTargetVarShort = Math.Min(sp1Inputs.targetVarInputShort / 100 + 1, sp2Inputs.targetVarInputShort / 100 + 1);
                   }
               }

               bool goNext = false;

               // do any buying or selling
               if (buyLong && !TBRun)
               {
                   stopLossVar = (double)thisInput.var4 * Math.Abs((double)targetVar * (double)candles.currentCandle.mATypicalLongTypical - (double)candles.currentCandle.mATypicalLongTypical);

                   if (thisModel.matchProTrend)
                   {
                       stopLossVar = (double)((int)(stopLossVar * 10)) / 10;
                   }
                   //stopPrice = stopLossVar;
                   //stopPriceOld = stopLossVar;

                   //stopLossVar = (double)thisInput.var4 * Math.Abs((double)targetVar * (double)currentCandle.MovingAverages[newVar1].movingAverage.Typical - (double)currentCandle.MovingAverages[newVar1].movingAverage.Typical);
                   bool buyOK = await thisModel.buy(candles.currentCandle.candleStart, candles.currentCandle.candleData.FirstOffer, candles.currentCandle.candleData.FirstBid, modelVar.quantity, stopLossVar, log);
                   if (buyOK)
                   {
                       thisModel.currentTrade.tradeStarted = candles.currentCandle.candleStart;
                       stopPrice = stopLossVar;
                       stopPriceOld = stopLossVar;
                       followOnEntry = 0;
                       buyLong = false;
                       goNext = false;
                       onMarket = true;
                       longOnmarket = true;
                   }
               }
               else
               {
                   if (sellLong && !TBRun)
                   {
                       thisModel.currentTrade.tradeEnded = candles.currentCandle.candleStart;
                       bool sellOK = await thisModel.sell(candles.currentCandle.candleStart, candles.currentCandle.candleData.FirstOffer, candles.currentCandle.candleData.FirstBid, false, log, modelVar);

                       sellLong = false;
                       goNext = false;
                       onMarket = false;
                       longOnmarket = false;
                   }
               }

               if (sellShort && !TBRun)
               {
                   stopLossVar = (double)thisInput.var5 * Math.Abs((double)targetVarShort * (double)candles.currentCandle.mATypicalShortTypical - (double)candles.currentCandle.mATypicalShortTypical);


                   if (thisModel.matchProTrend)
                   {
                       stopLossVar = (double)((int)(stopLossVar * 10)) / 10;
                   }

                   bool sellOK = await thisModel.sellShort(candles.currentCandle.candleStart, candles.currentCandle.candleData.FirstOffer, candles.currentCandle.candleData.FirstBid, modelVar.quantity, stopLossVar, log);
                   if (sellOK)
                   {
                       thisModel.currentTrade.tradeStarted = candles.currentCandle.candleStart;
                       stopPrice = stopLossVar;
                       stopPriceOld = stopLossVar;

                       followOnEntry = 0;
                       sellShort = false;
                       goNext = false;
                       onMarket = true;
                       shortOnMarket = true;
                   }
               }
               else
               {
                   if (buyShort && !TBRun)
                   {
                       thisModel.currentTrade.tradeEnded = candles.currentCandle.candleStart;
                       bool buyOK = await thisModel.buyShort(candles.currentCandle.candleStart, candles.currentCandle.candleData.FirstOffer, candles.currentCandle.candleData.FirstBid, false, log, modelVar);
                       if (buyOK)
                       {
                           buyShort = false;
                           goNext = false;
                           onMarket = false;
                           shortOnMarket = false;
                       }
                   }
               }

               if (!goNext)
               {
                   if (index > 29)
                   {
                       //clsMinuteCandle prevCandle = minuteCandles[prevCandleIndex];
                       //clsMinuteCandle prevCandle2 = minuteCandles[prevCandleIndex - 1];

                       //prevCandleIndex = index;

                       if (candles.currentCandle.mATypicalShortTypical > 0 && candles.prevCandle.mATypicalLongTypical > 0 && candles.currentCandle.mA30MinTypicalShortClose > 0 && candles.prevCandle.mA30MinTypicalShortClose > 0)
                       {

                           //Check trading Days
                           if (!await IGModels.clsCommonFunctions.IsTradingOpen(candles.currentCandle.candleStart, this.exchangeClosedDates))
                           //if (!IGModels.clsCommonFunctions.IsTradingOpen(candles.currentCandle.candleStart) || onMarket)
                           {
                               doNotTrade = 1;
                           }
                           else
                           {
                               doNotTrade = 0;
                           }



                           ///////////////////////
                           // Long term trades ///
                           ///////////////////////

                           if (candles.currentCandle != null && candles.prevCandle != null && candles.prevCandle2 != null && candles.prevMACandle != null)
                           {
                               if (candles.currentCandle.mA30MinTypicalLongClose > candles.prevMACandle.mA30MinTypicalLongClose)
                               {
                                   longTermTrend = 1;
                               }
                               else
                               {
                                   if (candles.currentCandle.mA30MinTypicalShortClose < candles.prevMACandle.mA30MinTypicalShortClose)
                                   {
                                       longTermTrend = -1;
                                   }
                                   else
                                   {
                                       longTermTrend = 0;
                                   }
                               }

                               bool continueRun = true;

                               if (continueRun)
                               {
                                   if (logModel)
                                   {
                                       //log.modelRunID = this.modelRunID;
                                       log.seqNo = index - 1;
                                       log.candleStart = candles.currentCandle.candleStart;

                                       log.LTT = longTermTrend;
                                       log.longLTTValue = candles.currentCandle.mA30MinTypicalLongClose;
                                       log.longLTTPrevValue = candles.prevMACandle.mA30MinTypicalLongClose;
                                       log.shortLTTValue = candles.currentCandle.mA30MinTypicalShortClose;
                                       log.shortLTTPrevValue = candles.prevMACandle.mA30MinTypicalShortClose;
                                       log.H = candles.currentCandle.candleData.High;
                                       log.L = candles.currentCandle.candleData.Low;
                                       log.O = candles.currentCandle.candleData.Open;
                                       log.C = candles.currentCandle.candleData.Close;
                                       log.T = candles.currentCandle.candleData.Typical;
                                       log.shortMAT = candles.currentCandle.mATypicalShortTypical;
                                       log.shortPrevMAT = candles.prevCandle.mATypicalShortTypical;
                                       log.longMAT = candles.currentCandle.mATypicalLongTypical;
                                       log.longPrevMAT = candles.prevCandle.mATypicalLongTypical;
                                       log.strategyProfit = modelVar.strategyProfit;
                                       log.carriedForwardLoss = modelVar.carriedForwardLoss;
                                       log.breakevenVar = modelVar.breakEvenVar;
                                       log.counter = modelVar.counter;
                                       //log.var1 = thisInput.var1;
                                       log.inputs = thisInput;
                                   }
                                   bool newTrade = false;

                                   // Check to see if we need to sell a Stop Loss trade first.

                                   // set stops and limits
                                   if (longOnmarket)
                                   {
                                       stopPriceOld = stopPrice;
                                       //check to see if the current stoploss value is different from the previous
                                       stopPrice = (double)thisInput.var4 * Math.Abs((double)targetVar * (double)candles.currentCandle.mATypicalLongTypical - (double)candles.currentCandle.mATypicalLongTypical);

                                       if (thisModel.matchProTrend)
                                       {
                                           stopPrice = (double)((int)(stopPrice * 10)) / 10;
                                       }

                                       stopPrice = Math.Min(stopPrice, stopPriceOld);

                                       if (stopPrice > thisModel.currentTrade.stopLossValue)
                                       {
                                           thisModel.currentTrade.stopLossValue = stopPrice;
                                       }


                                       decimal stopSellPrice = 0;

                                       if (modelVar.breakEvenVar == 0)
                                       {
                                           if (thisModel.matchProTrend)
                                           {
                                               stopSellPrice = Math.Round(thisModel.currentTrade.buyPrice - (decimal)thisModel.currentTrade.stopLossValue, 1);
                                           }
                                           else
                                           {
                                               stopSellPrice = thisModel.currentTrade.buyPrice - (decimal)thisModel.currentTrade.stopLossValue;
                                           }
                                       }
                                       else
                                       {

                                           //thisModel.currentTrade.stopLossValue = 0.94 * Math.Abs((double)targetVar * (double)candles.currentCandle.mATypicalLongTypical - (double)candles.currentCandle.mATypicalLongTypical);
                                           thisModel.currentTrade.stopLossValue = 1 * Math.Abs((double)targetVar * (double)candles.currentCandle.mATypicalLongTypical - (double)candles.currentCandle.mATypicalLongTypical);

                                           if (thisModel.matchProTrend)
                                           {
                                               stopSellPrice = Math.Round(thisModel.currentTrade.buyPrice + (decimal)thisModel.currentTrade.stopLossValue, 1);
                                           }
                                           else
                                           {
                                               stopSellPrice = thisModel.currentTrade.buyPrice + (decimal)thisModel.currentTrade.stopLossValue;
                                           }

                                           //thisModel.currentTrade.stopLossValue = 0;
                                       }


                                       log.stopLossValue = (double)stopSellPrice;


                                       if (candles.currentCandle.candleData.Low <= stopSellPrice && !TBRun)
                                       {
                                           ////////////////////////////////
                                           // Sell Long due to stop loss //
                                           ////////////////////////////////
                                           //Console.WriteLine("l-Counter = " + counter);
                                           thisModel.currentTrade.tradeEnded = candles.currentCandle.candleStart;
                                           bool sellOk = await thisModel.sell(candles.currentCandle.candleStart, candles.currentCandle.candleData.FirstOffer, candles.currentCandle.candleData.FirstBid, true, log, modelVar);
                                           sellLong = false;
                                           onMarket = false;
                                           longOnmarket = false;
                                           doNotTrade = 0;
                                       }
                                   }

                                   if (shortOnMarket)
                                   {
                                       stopPriceOld = stopPrice;
                                       decimal stopBuyPrice = 0;
                                       //check to see if the current stoploss value is different from the previous
                                       stopPrice = (double)thisInput.var5 * Math.Abs((double)targetVarShort * (double)candles.currentCandle.mATypicalShortTypical - (double)candles.currentCandle.mATypicalShortTypical);

                                       if (thisModel.matchProTrend)
                                       {
                                           stopPrice = (double)((int)(stopPrice * 10)) / 10;
                                       }
                                       stopPrice = Math.Min(stopPrice, stopPriceOld);

                                       if (stopPrice < thisModel.currentTrade.stopLossValue)
                                       {
                                           thisModel.currentTrade.stopLossValue = stopPrice;
                                       }


                                       if (modelVar.breakEvenVar == 0)
                                       {
                                           if (thisModel.matchProTrend)
                                           {
                                               stopBuyPrice = Math.Round(thisModel.currentTrade.sellPrice + (decimal)thisModel.currentTrade.stopLossValue, 1);
                                           }
                                           else
                                           {
                                               stopBuyPrice = thisModel.currentTrade.sellPrice + (decimal)thisModel.currentTrade.stopLossValue;
                                           }
                                       }
                                       else
                                       {
                                           //thisModel.currentTrade.stopLossValue = 0.94 * Math.Abs((double)targetVarShort * (double)candles.currentCandle.mATypicalShortTypical - (double)candles.currentCandle.mATypicalShortTypical);
                                           thisModel.currentTrade.stopLossValue = 1 * Math.Abs((double)targetVarShort * (double)candles.currentCandle.mATypicalShortTypical - (double)candles.currentCandle.mATypicalShortTypical);

                                           if (thisModel.matchProTrend)
                                           {
                                               stopBuyPrice = Math.Round(thisModel.currentTrade.sellPrice - (decimal)thisModel.currentTrade.stopLossValue, 1);
                                           }
                                           else
                                           {
                                               stopBuyPrice = thisModel.currentTrade.sellPrice - (decimal)thisModel.currentTrade.stopLossValue;
                                           }

                                           //thisModel.currentTrade.stopLossValue = 0;
                                       }

                                       log.stopLossValue = (double)stopBuyPrice;
                                       if (candles.currentCandle.candleData.High >= stopBuyPrice && !TBRun)
                                       {
                                           ////////////////////////////////
                                           // Buy short due to stop loss //
                                           ////////////////////////////////
                                           //stopPriceOld = stopPrice;
                                           //Console.WriteLine("s-Counter = " + counter);
                                           thisModel.currentTrade.tradeEnded = candles.currentCandle.candleStart;
                                           bool sellOk = await thisModel.buyShort(candles.currentCandle.candleStart, candles.currentCandle.candleData.FirstOffer, candles.currentCandle.candleData.FirstBid, true, log, modelVar);
                                           buyShort = false;
                                           onMarket = false;
                                           shortOnMarket = false;
                                           doNotTrade = 0;

                                       }
                                   }

                                   ///////////////////////////////////////////////////////////////////////////
                                   // Not currently doing a trade so lets see if we need to do a long trade //
                                   ///////////////////////////////////////////////////////////////////////////
                                   ///
                                   if (!onMarket)
                                   {
                                       try
                                       {
                                           if ((candles.currentCandle.mATypicalLongTypical > candles.prevCandle.mATypicalLongTypical) && longTermTrend == 1 && doNotTrade == 0 && doLongs)
                                           {
                                               if (candles.currentCandle.candleData.Typical > candles.currentCandle.mATypicalLongTypical && candles.prevCandle.candleData.Typical < candles.prevCandle.mATypicalLongTypical)
                                               {
                                                   //////////////
                                                   // Buy long //
                                                   //////////////
                                                   ///
                                                   //Console.WriteLine("buy counter = " + counter);
                                                   modelVar.setQuantity((double)nightingaleTargetVar, (double)candles.currentCandle.mATypicalLongTypical, counter);
                                                   log.counter = modelVar.counter;
                                                   log.carriedForwardLoss = modelVar.carriedForwardLoss;
                                                   log.quantity = modelVar.quantity;
                                                   modelVar.breakEvenVar = 0;
                                                   buyLong = true;
                                                   newTrade = true;
                                               }
                                           }
                                           else
                                           {
                                               ////////////////////////////////////////////////////////////////////////////
                                               // Not currently doing a trade so lets see if we need to do a short trade //
                                               ////////////////////////////////////////////////////////////////////////////
                                               try
                                               {

                                                   if ((candles.currentCandle.mATypicalShortTypical < candles.prevCandle.mATypicalShortTypical) && longTermTrend == -1 && doNotTrade == 0 && doShorts)
                                                   {
                                                       if (candles.currentCandle.candleData.Typical < candles.currentCandle.mATypicalShortTypical && candles.prevCandle.candleData.Typical > candles.prevCandle.mATypicalShortTypical)
                                                       {
                                                           ////////////////
                                                           // Sell short //
                                                           ////////////////
                                                           ///
                                                           //Console.WriteLine("sell counter = " + counter);
                                                           modelVar.setQuantity((double)nightingaleTargetVarShort, (double)candles.currentCandle.mATypicalShortTypical, counter);

                                                           log.counter = modelVar.counter;
                                                           log.carriedForwardLoss = modelVar.carriedForwardLoss;
                                                           log.quantity = modelVar.quantity;
                                                           modelVar.breakEvenVar = 0;
                                                           sellShort = true;
                                                           newTrade = true;
                                                       }
                                                   }
                                               }
                                               catch (Exception ex)
                                               {
                                                   var a = ex;
                                               }
                                           }
                                       }
                                       catch (Exception ex)
                                       {
                                           var a = ex;
                                       }
                                   }
                                   //////////////////////////
                                   // set stops and limits //
                                   //////////////////////////
                                   if (longOnmarket)
                                   {
                                       thisModel.currentTrade.targetPrice = thisModel.currentTrade.buyPrice + Math.Abs((decimal)targetVar * (decimal)candles.currentCandle.mATypicalLongTypical - (decimal)candles.currentCandle.mATypicalLongTypical);
                                       log.target = thisModel.currentTrade.targetPrice;// thisModel.currentTrade.buyPrice + Math.Abs((decimal)targetVar * (decimal)candles.currentCandle.mATypicalLongTypical - (decimal)candles.currentCandle.mATypicalLongTypical);

                                       stopPriceOld = stopPrice;
                                       stopPrice = thisInput.var4 * Math.Abs((double)targetVar * (double)candles.currentCandle.mATypicalLongTypical - (double)candles.currentCandle.mATypicalLongTypical);
                                       if (thisModel.matchProTrend)
                                       {
                                           stopPrice = (double)((int)(stopPrice * 10)) / 10;
                                       }

                                       stopPrice = Math.Min(stopPrice, stopPriceOld);

                                       if (modelVar.breakEvenVar == 0)
                                       {
                                           thisModel.currentTrade.stopLossValue = stopPrice;
                                       }
                                       else
                                       {
                                           //thisModel.currentTrade.stopLossValue = 0.94 * Math.Abs((double)targetVar  * (double)candles.currentCandle.mATypicalLongTypical - (double)candles.currentCandle.mATypicalLongTypical);
                                           thisModel.currentTrade.stopLossValue = 1 * Math.Abs((double)targetVar * (double)candles.currentCandle.mATypicalLongTypical - (double)candles.currentCandle.mATypicalLongTypical);

                                           //thisModel.currentTrade.stopLossValue = 0;
                                       }

                                       if (candles.currentCandle.candleData.Close > thisModel.currentTrade.buyPrice + Math.Abs((decimal)targetVar * (decimal)candles.currentCandle.mATypicalLongTypical - (decimal)candles.currentCandle.mATypicalLongTypical))//|| longTermTrend == 0)
                                       {
                                           if (candles.currentCandle.candleData.Low < candles.prevCandle2.candleData.Low)
                                           {
                                               ///////////////
                                               // Sell long //
                                               ///////////////
                                               sellLong = true;
                                               onMarket = false;
                                               longOnmarket = false;
                                           }
                                           else
                                           {
                                               //thisModel.currentTrade.stopLossValue = 0.94 * Math.Abs((double)targetVar  * (double)candles.currentCandle.mATypicalLongTypical - (double)candles.currentCandle.mATypicalLongTypical);
                                               thisModel.currentTrade.stopLossValue = 1 * Math.Abs((double)targetVar * (double)candles.currentCandle.mATypicalLongTypical - (double)candles.currentCandle.mATypicalLongTypical);
                                               //thisModel.currentTrade.stopLossValue = 0;
                                               modelVar.breakEvenVar = 1;
                                           }
                                       }
                                       if (modelVar.breakEvenVar == 1 && candles.currentCandle.candleData.Close < thisModel.currentTrade.buyPrice + Math.Abs((decimal)targetVar * (decimal)candles.currentCandle.mATypicalLongTypical - (decimal)candles.currentCandle.mATypicalLongTypical))
                                       {
                                           sellLong = true;
                                           onMarket = false;
                                           longOnmarket = false;
                                       }
                                   }

                                   if (shortOnMarket)
                                   {
                                       thisModel.currentTrade.targetPrice = thisModel.currentTrade.sellPrice - Math.Abs((decimal)targetVarShort * (decimal)candles.currentCandle.mATypicalShortTypical - (decimal)candles.currentCandle.mATypicalShortTypical);
                                       log.target = thisModel.currentTrade.targetPrice;// thisModel.currentTrade.sellPrice - Math.Abs((decimal)targetVarShort * (decimal)candles.currentCandle.mATypicalShortTypical - (decimal)candles.currentCandle.mATypicalShortTypical);
                                       log.breakevenVar = modelVar.breakEvenVar;
                                       stopPriceOld = stopPrice;
                                       stopPrice = thisInput.var5 * Math.Abs((double)targetVarShort * (double)candles.currentCandle.mATypicalShortTypical - (double)candles.currentCandle.mATypicalShortTypical);
                                       stopPrice = Math.Min(stopPrice, stopPriceOld);
                                       if (thisModel.matchProTrend)
                                       {
                                           stopPrice = (double)((int)(stopPrice * 10)) / 10;
                                       }
                                       if (modelVar.breakEvenVar == 0)
                                       {
                                           thisModel.currentTrade.stopLossValue = stopPrice;
                                       }
                                       else
                                       {
                                           //thisModel.currentTrade.stopLossValue = 0;
                                           //thisModel.currentTrade.stopLossValue = 0.94 * Math.Abs((double)targetVarShort * (double)candles.currentCandle.mATypicalShortTypical - (double)candles.currentCandle.mATypicalShortTypical);
                                           thisModel.currentTrade.stopLossValue = 1 * Math.Abs((double)targetVarShort * (double)candles.currentCandle.mATypicalShortTypical - (double)candles.currentCandle.mATypicalShortTypical);

                                       }

                                       if (candles.currentCandle.candleData.Close < thisModel.currentTrade.sellPrice - Math.Abs((decimal)targetVarShort * (decimal)candles.currentCandle.mATypicalShortTypical - (decimal)candles.currentCandle.mATypicalShortTypical))
                                       {
                                           if (candles.currentCandle.candleData.Close > candles.prevCandle2.candleData.Close)
                                           {
                                               ///////////////
                                               // Buy short //
                                               ///////////////
                                               onMarket = false;
                                               shortOnMarket = false;
                                               buyShort = true;
                                               newTrade = true;
                                           }
                                           else
                                           {
                                               //thisModel.currentTrade.stopLossValue = 0;
                                               //thisModel.currentTrade.stopLossValue = 0.94 * Math.Abs((double)targetVarShort * (double)candles.currentCandle.mATypicalShortTypical - (double)candles.currentCandle.mATypicalShortTypical);
                                               thisModel.currentTrade.stopLossValue = 1 * Math.Abs((double)targetVarShort * (double)candles.currentCandle.mATypicalShortTypical - (double)candles.currentCandle.mATypicalShortTypical);

                                               modelVar.breakEvenVar = 1;
                                           }
                                       }
                                       if (modelVar.breakEvenVar == 1 && candles.currentCandle.candleData.Close > thisModel.currentTrade.sellPrice - Math.Abs((decimal)targetVarShort * (decimal)candles.currentCandle.mATypicalShortTypical - (decimal)candles.currentCandle.mATypicalShortTypical))
                                       {
                                           onMarket = false;
                                           shortOnMarket = false;
                                           buyShort = true;
                                           newTrade = true;
                                       }
                                   }

                                   if (logModel)
                                   {
                                       log.onMarket = onMarket || sellLong || buyShort;
                                       log.onLongMarket = longOnmarket || sellLong;
                                       log.onShortMarket = shortOnMarket || buyShort;
                                       log.stopPrice = stopPrice;
                                       log.stopPriceOld = stopPriceOld;
                                   }

                                   // See if this is the penultimate candle. If it is, then finish any exisitng trades
                                   if (index == minuteCandles.Count - 2)
                                   {
                                       if (longOnmarket)
                                       {
                                           sellLong = true;
                                           onMarket = false;
                                           longOnmarket = false;
                                       }
                                       if (shortOnMarket)
                                       {
                                           sellShort = true;
                                           onMarket = false;
                                           shortOnMarket = false;
                                       }
                                   }
                                   ///////////////////////
                                   // Save the log file //
                                   ///////////////////////

                                   if (log.candleStart > DateTime.MinValue && logModel)
                                   {
                                       //await log.Add(this.the_db);
                                       modelLogs.logs.Add(log);
                                   }
                               }
                           }

                       }
                   }
               }



           }
           catch (Exception e)
           {
               var err = 1;
           }


       }